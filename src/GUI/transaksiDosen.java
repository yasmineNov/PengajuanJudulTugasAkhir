/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

package GUI;

import Program.*;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.StringTokenizer;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author yasmine
 */
public class transaksiDosen extends javax.swing.JFrame {
    private login logi;
    private Dospem dos;
    private Prodi pro;
    /** Creates new form transaksiDosen */
    public transaksiDosen() {
        initComponents();
    }

    public transaksiDosen(login log) {
        initComponents();
        logi = log;
        getJudul();
        setujubutton.setVisible(false);
        if(logi.getTypeLogin().equals("Dosen"))
            dos = new Dospem().getSingleDatabase(logi.getIdLogin());
        else
            pro = new Prodi().getSingleDatabase(Integer.parseInt(logi.getIdLogin()));
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        Detail = new javax.swing.JPanel();
        jScrollPane2 = new javax.swing.JScrollPane();
        TBdos = new javax.swing.JTable();
        setujubutton = new javax.swing.JButton();
        kembali = new javax.swing.JButton();
        jLabel2 = new javax.swing.JLabel();
        BACKGROUND = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setUndecorated(true);

        Detail.setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        TBdos.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Nim", "Nama", "id - judul", "Deskripsi", "tgl. Pengajuan", "Acc Dosen", "Ket.", "Acc Prodi", "Ket."
            }
        ));
        TBdos.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                TBdosMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(TBdos);

        Detail.add(jScrollPane2, new org.netbeans.lib.awtextra.AbsoluteConstraints(90, 180, 510, 180));

        setujubutton.setText("Setuju");
        setujubutton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                setujubuttonActionPerformed(evt);
            }
        });
        Detail.add(setujubutton, new org.netbeans.lib.awtextra.AbsoluteConstraints(560, 390, 90, -1));

        kembali.setText("Kembali");
        Detail.add(kembali, new org.netbeans.lib.awtextra.AbsoluteConstraints(60, 390, -1, -1));

        jLabel2.setFont(new java.awt.Font("Tahoma", 1, 24)); // NOI18N
        jLabel2.setText("Daftar Tugas Akhir Mahasiswa");
        Detail.add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 140, -1, -1));

        BACKGROUND.setFont(new java.awt.Font("Malgun Gothic", 1, 14)); // NOI18N
        Detail.add(BACKGROUND, new org.netbeans.lib.awtextra.AbsoluteConstraints(0, 0, -1, -1));

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(Detail, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(Detail, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void setujubuttonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_setujubuttonActionPerformed
        // TODO add your handling code here:
        String teks = TBdos.getValueAt(TBdos.getSelectedRow(), 2).toString();
        StringTokenizer token = new StringTokenizer(teks, " - ");
        if(logi.getTypeLogin().equals("Dosen")){
            KeputusanDospem Kd = new KeputusanDospem(true);
            Kd.insertToDatabase();
        }
        else{
            KeputusanProdi Kp = new KeputusanProdi(true);
            Kp.insertToDatabase();
        }
    }//GEN-LAST:event_setujubuttonActionPerformed

    private void TBdosMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_TBdosMouseClicked
        // TODO add your handling code here:
        if(TBdos.getValueAt(TBdos.getSelectedRow(), (logi.getTypeLogin().equals("Dosen"))? 5 : 7) != null){
            setujubutton.setVisible(false);
        }
        else
            setujubutton.setVisible(true);
    }//GEN-LAST:event_TBdosMouseClicked

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(transaksiDosen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(transaksiDosen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(transaksiDosen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(transaksiDosen.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new transaksiDosen().setVisible(true);
            }
        });
    }
    public void getJudul(){
        DefaultTableModel model = (DefaultTableModel) TBdos.getModel();
        model.setRowCount(0);
        Object[] atribut = new Object[7];
        ArrayList<Judul> listJudul = new Judul().getAllDatabase();
        Iterator<Judul> tiapJudul = listJudul.iterator();
        while(tiapJudul.hasNext()){
            Judul jud = tiapJudul.next();
            
            KeputusanDospem Kd = new KeputusanDospem();
            ArrayList<KeputusanDospem> listKeputusanDospem = new KeputusanDospem().getAllDatabase();
            Iterator<KeputusanDospem> tiapKeputusanDospem = listKeputusanDospem.iterator();
            while(tiapKeputusanDospem.hasNext()){
                KeputusanDospem KdTemp = tiapKeputusanDospem.next();
                if(jud.getIdJudul() == KdTemp.putusanDosen.getIdJudul()){
                    Kd = KdTemp;
                    break;
                }
            }
            
            KeputusanProdi Kp = new KeputusanProdi();
            ArrayList<KeputusanProdi> listKeputusanProdi = new KeputusanProdi().getAllDatabase();
            Iterator<KeputusanProdi> tiapKeputusanProdi = listKeputusanProdi.iterator();
            while(tiapKeputusanProdi.hasNext()){
                KeputusanProdi KpTemp = tiapKeputusanProdi.next();
                if(jud.getIdJudul() == KpTemp.putusanJdl.getIdJudul()){
                    Kp = KpTemp;
                    break;
                }
            }
            
            atribut[0] = jud.mahasiswadalamtugas.getNim();
            atribut[1] = jud.mahasiswadalamtugas.getNama();
            atribut[2] = jud.getIdJudul()+ " - " + jud.getNamaJudul();
            atribut[3] = jud.getDeskripsi();
            atribut[4] = jud.getTglPengajuan();
            atribut[5] = Kd.getStatusDospem();
            atribut[6] = Kd.getTglAccDosen();
            atribut[7] = Kp.getStatusProdi();
            atribut[8] = Kp.getTglAccProdi();
           
            model.addRow(atribut);
        }
        TBdos.setModel(model);
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel BACKGROUND;
    private javax.swing.JPanel Detail;
    private javax.swing.JTable TBdos;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JButton kembali;
    private javax.swing.JButton setujubutton;
    // End of variables declaration//GEN-END:variables

}
